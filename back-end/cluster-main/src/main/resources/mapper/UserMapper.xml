<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cluster.mapper.UserMapper">

    <select id="getUserById" resultType="User">
        select id,username,`name`, email, phone, datejoined, gender, signature, `rank`, avatarpath from users where id = #{id}
    </select>

    <select id="getAllUsers" resultType="User">
        select id,`name`, gender, signature, `rank`, avatarpath from users
    </select>

    <select id="getUserByUsername" resultType="User">
        select id, username, `name`, password, email, phone, datejoined, gender, signature,`rank`,avatarpath from users where username =#{username}
    </select>

    <select id="getUserRank" resultType="java.lang.Integer">
        select `rank` from users where id = #{id}
    </select>

    <insert id="registerUser">
        insert INTO users VALUES(null, #{username}, #{password}, #{enabled}, #{name}, #{email},
                                #{phone}, #{dateJoined}, #{gender}, #{signature}, #{rank}, #{avatarPath})
    </insert>

    <update id="updateUser">
        update users set `name` = #{name},password = #{password}, email = #{email}, phone = #{phone},
                        gender = #{gender}, signature = #{signature}, avatarpath = #{avatarpath}
                        where id = #{id}
    </update>

    <update id="addRankPoint">
        update users set `rank` = #{rank} where id = #{id}
    </update>



    <delete id="deleteUser">
        delete from users where id = #{id}
    </delete>

    <select id="getRoleByUserId" resultType="Role">
        Select r.id, r.name, r.nameZh
        from Users u
        Inner join user_role ur on u.id = ur.uid
        Inner join roles r on ur.rid = r.id
        where u.id = #{id}
    </select>

    <insert id="insertUserRole">
        Insert INTO user_role (uid, rid) values(#{uid}, #{rid})
    </insert>






</mapper>